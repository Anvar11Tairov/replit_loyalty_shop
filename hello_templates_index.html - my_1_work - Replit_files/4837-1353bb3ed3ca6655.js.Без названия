(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4837],{34837:function(e){e.exports=e=>{const t=o("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAAAQCAYAAAAoEfIQAAAAAXNSR0IArs4c6QAAActJREFUaIHtmttuwyAMQEm1//9l9kTEHGyMb4HVR6rSJYAdX8CDlpIkSZIkSbITFXxO5WTdT8fd9pe3AANqidWzGR3KxO7DNhpde4dj8mc6aPtYEO0zS0ZJJ3mXENvvbuQVI6zOdqPxOIE3a6MJXgv5fTvI7v5+m2ZbGHerPtXYHpM1vP+zoMCqEpr+UrT6WemwwwrU5EfqwrGrNpAlaMda9anG9iNZ6DhYAltAlYAcYHvvQOSOz3GmNIm58iksKgTpBGxVJXlMsJIEhPciJsMKrv39h+yPszLfDCzFItAmSNuwowKYI0Pz3hV8l2wkYv0i/DHSlfsO2D7LBZ7feK7AGqgAe7s0XSGynKYCdWRPdpnWEVGW9xPfqIqTVCCcDUgLqMlv1obrvz/9d03g/0RUEmOBP0pU2Ibq3xOVCB7VS9QmlKbP7L0fzz0TWOMA7EU8A4ebaFYbE9KxqTbcwKf6Nxkrcrms9Lf09UlVWynzFfoGS+BIR1FjvHWO6UHkSqx5zm0zYzaReJ1lnxo3V3etyPf++vzjcCzOgftxvP6PopLY8occeQ4sY1bCavpzx2CTDsWBjjjRVrutRKdtQibJ60QfZSVJkiQcfgHLRY8eT2qnRAAAAABJRU5ErkJggg=="),a=o("data:image/png;base64,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"),r={};a.onload=()=>{const e=a.width/8;" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~".split("").forEach(((t,a)=>{r[t]=[~~(a%e),~~(a/e)]}))};const s={pen:{cursor:"crosshair",key:"q",icon:0},erasor:{cursor:"crosshair",key:"w",icon:1},bucket:{cursor:"crosshair",key:"e",icon:2},rect:{cursor:"crosshair",key:"a",icon:3},circle:{cursor:"crosshair",key:"s",icon:4},line:{cursor:"crosshair",key:"d",icon:5},select:{cursor:"cell",key:"z",icon:6},move:{cursor:"move",key:"x",icon:7},eyedropper:{cursor:"crosshair",key:"c",icon:8}};function o(e,t){const a=new window.Image;return a.src=e,t&&(a.onload=()=>{t(a)}),a}function n(e,t,a){return Math.max(Math.min(e,a),t)}function i(e){return function(e){const t=new Image;return t.src=e,new Promise(((e,a)=>{t.onload=()=>{e(t)},t.onerror=()=>{a()}}))}(e).then((e=>c(e)))}const c=(e,t)=>{const a=document.createElement("canvas");let r=(()=>{if(e instanceof window.ImageData)return new window.ImageData(new Uint8ClampedArray(e.data),e.width,e.height);if(e instanceof window.Image){a.width=e.width,a.height=e.height;const t=a.getContext("2d");return t.drawImage(e,0,0),t.getImageData(0,0,e.width,e.height)}return new window.ImageData(new Uint8ClampedArray(e*t*4).fill(0),e,t)})();function s(){a.width=r.width,a.height=r.height;a.getContext("2d").putImageData(r,0,0)}function o(e,t){return 4*(t*r.width+e)}return{blend:"alpha",scissorRect:null,width:()=>r.width,height:()=>r.height,toImageData:()=>new window.ImageData(new Uint8ClampedArray(r.data),r.width,r.height),clone(){return c(this.toImageData())},clear(){r=new window.ImageData(new Uint8ClampedArray(r.width*r.height*4).fill(0),r.width,r.height)},set(e,t,a){if(!this.checkPt(e,t))return!1;const s=o(e,t);switch(this.blend){case"alpha":{const e=a[3]/255;r.data[s+0]=r.data[s+0]*(1-e)+a[0]*e,r.data[s+1]=r.data[s+1]*(1-e)+a[1]*e,r.data[s+2]=r.data[s+2]*(1-e)+a[2]*e,r.data[s+3]=r.data[s+3]*(1-e)+a[3]*e;break}case"replace":r.data[s+0]=a[0],r.data[s+1]=a[1],r.data[s+2]=a[2],r.data[s+3]=a[3];break;case"add":{const e=r.data[s+3]/255,t=a[3]/255;r.data[s+0]=r.data[s+0]*e+a[0]*t,r.data[s+1]=r.data[s+1]*e+a[1]*t,r.data[s+2]=r.data[s+2]*e+a[2]*t,r.data[s+3]=r.data[s+3]*e+a[3]*t;break}}return!0},get(e,t){const a=o(e,t);return[r.data[a+0],r.data[a+1],r.data[a+2],r.data[a+3]]},line(e,t,a,r,s){const o=a-e,n=r-t,i=Math.abs(o),c=Math.abs(n);let l=0;const h=o>0?1:-1,f=n>0?1:-1;if(i>c)for(let d=e,m=t;h<0?d>=a:d<=a;d+=h)this.set(d,m,s),l+=c,l<<1>=i&&(m+=f,l-=i);else for(let d=e,m=t;f<0?m>=r:m<=r;m+=f)this.set(d,m,s),l+=i,l<<1>=c&&(d+=h,l-=c)},fillRect(e,t,a,r,s){a<0&&(e+=a,a=-a),r<0&&(t+=r,r=-r);for(let o=e;o<e+a;o++)for(let e=t;e<t+r;e++)this.set(o,e,s)},strokeRect(e,t,a,r,s){a<0&&(e+=a,a=-a),r<0&&(t+=r,r=-r),this.line(e,t,e+a,t,s),this.line(e+a,t,e+a,t+r,s),this.line(e+a,t+r,e,t+r,s),this.line(e,t+r,e,t,s)},fillCircle(e,t,a,r){for(let s=e-(a=Math.abs(a));s<=e+a;s++)for(let o=t-a;o<=t+a;o++){Math.sqrt((s-e)**2+(o-t)**2)<=a&&this.set(s,o,r)}},bucket(e,t,a){if(!this.checkPt(e,t))return!1;const r=this.get(e,t);if(l(r,a))return!1;const s=[];for(s.push([e,t]);s.length;){const[e,t]=s.pop();this.checkPt(e,t)&&(l(this.get(e,t),r)&&(this.set(e,t,a),s.push([e,t-1]),s.push([e-1,t]),s.push([e+1,t]),s.push([e,t+1])))}return!0},merge(e,t=0,a=0){for(let s=0;s<r.width;s++)for(let o=0;o<r.height;o++){const n=e.get(s,o);n&&s+t>=0&&s+t<r.width&&o+a>=0&&o+a<r.height&&this.set(s+t,o+a,n)}},checkPt(e,t){if(this.scissorRect){const a=this.scissorRect;return e>=a[0][0]&&e<a[1][0]&&t>=a[0][1]&&t<a[1][1]}return e>=0&&e<r.width&&t>=0&&t<r.height},clampPt:e=>[n(e[0],0,r.width),n(e[1],0,r.height)],bbox(){let e=[0,0],t=[r.width-1,r.height-1];e:for(let a=e[0];a<=t[0];a++)for(let s=e[1];s<=t[1];s++){const t=o(a,s);if(0!==r.data[t+3]){e[0]=a;break e}}e:for(let a=t[0];a>=e[0];a--)for(let s=e[1];s<=t[1];s++){const e=o(a,s);if(0!==r.data[e+3]){t[0]=a;break e}}e:for(let a=e[1];a<=t[1];a++)for(let s=e[0];s<=t[0];s++){const t=o(s,a);if(0!==r.data[t+3]){e[1]=a;break e}}e:for(let a=t[1];a>=e[1];a--)for(let s=e[0];s<=t[0];s++){const e=o(s,a);if(0!==r.data[e+3]){t[1]=a;break e}}return[e,t]},crop(e,t){const a=t[0]-e[0]+1,s=t[1]-e[1]+1,o=c(a,s);for(let r=e[0];r<=t[0];r++)for(let a=e[1];a<=t[1];a++)o.set(r-e[0],a-e[1],this.get(r,a));r=o.toImageData()},toDataURL:()=>(s(),a.toDataURL("image/png")),toPNG(){const e=this.toDataURL().replace(/^data:image\/png;base64,/,""),t=window.atob(e),a=new Uint8Array(t.length);for(let r=0;r<a.length;r++)a[r]=t.charCodeAt(r);return a.buffer},drawable:()=>(s(),a),game(){const e=this.toImageData();for(let t=0;t<r.height;t++)for(let a=0;a<r.width;a++){let s=0,o=0,n=0,i=0;for(let e=-1;e<=1;e++)for(let c=-1;c<=1;c++)if((0!==e||0!==c)&&a-e>=0&&a+e<r.width&&t-c>=0&&t+c<r.height){const l=4*((t+c)*r.width+a+e);r.data[l+3]>0&&(o+=r.data[l+0],n+=r.data[l+1],i+=r.data[l+2],s++)}const c=4*(t*r.width+a);s<2||s>3?(e.data[c+0]=0,e.data[c+1]=0,e.data[c+2]=0,e.data[c+3]=0):3===s&&(e.data[c+0]=o/s,e.data[c+1]=n/s,e.data[c+2]=i/s,e.data[c+3]=255)}return c(e)}}};function l(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function h(e){return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}const f=e.canvas,d=e.canvas.getContext("2d"),m={width:e.width,height:e.height,curFrame:0,frames:[c(e.width||64,e.height||64)],fCanvas:c(64|e.width,e.height||64),anims:{},tool:"pen",color:[0,0,0,255],palette:e.palette||[[0,0,0,255],[255,255,255,255],[255,255,128,255],[255,128,255,255],[0,128,128,255],[128,0,255,255],[255,0,128,255],[0,255,255,255]],view:{offset:[0,0],scale:1},state:{stack:[],offset:0},modified:!1,readOnly:e.readOnly,events:{},curAnim:null,animTimer:0,animSpeed:200,gaming:!1,gameTimer:0,gameSpeed:100},u={mouseDown:!1,mousePressed:!1,mouseMoved:!1,mousePos:[0,0],mousePosPrev:[0,0],mouseStartPos:null,grabbin:!1,delCb:()=>{},hideUI:!1,loopID:null,time:0};b(),d.imageSmoothingEnabled=!1;const g={game:{icon:14,action:function(){m.gaming=!0,m.readOnly=!0,U()}},export:{icon:13,action:()=>F("export")},save:{icon:12,action:()=>F("save")},crop:{icon:9,action:function(){let e,t;m.frames.forEach((a=>{const[r,s]=a.bbox();e&&t?(e[0]=Math.min(e[0],r[0]),e[1]=Math.min(e[1],r[0]),t[0]=Math.max(t[0],s[0]),t[1]=Math.max(t[1],s[0])):(e=r,t=s)})),m.frames.forEach((a=>a.crop(e,t))),m.width=M().width(),m.height=M().height(),U()}},undo:{icon:10,key:"shift+z",action:O},redo:{icon:11,key:"meta+shift+z",action:C}},w=document.createElement("input");function p(e){return[~~((e[0]-m.view.offset[0])/m.view.scale),~~((e[1]-m.view.offset[1])/m.view.scale)]}function v(){m.view.scale<=2||(m.view.scale--,m.view.offset[0]+=m.width/2,m.view.offset[1]+=m.height/2)}function k(){m.view.scale>=64||(m.view.scale++,m.view.offset[0]-=m.width/2,m.view.offset[1]-=m.height/2)}function b(){const e=f.width,t=f.height,a=(e-120)/m.width,r=(t-120)/m.height;m.view.scale=~~Math.min(a,r),m.view.offset=[(e-m.width*m.view.scale)/2,(t-m.height*m.view.scale)/2]}function P(e=m.curFrame){m.frames.splice(m.curFrame,0,M().clone()),e===m.curFrame&&A(m.curFrame+1),U()}function y(e=m.curFrame){m.frames.length>1&&(m.frames.splice(e,1),m.curFrame===m.frames.length&&A(m.frames.length-1)),U()}function A(e){m.curFrame=e,u.delCb=()=>{confirm(`removed frame ${e}?`)&&y(e)}}function D(e){m.color=e,u.delCb=()=>{confirm("remove selected color?")&&(m.palette=m.palette.filter((e=>!l(e,m.color))),F("change",m.palette))}}function R(){A(0===m.curFrame?m.frames.length-1:m.curFrame-1)}function E(){A((m.curFrame+1)%m.frames.length)}function z(){const e=M(),[t,a]=e.scissorRect;e.blend="replace",e.fillRect(t[0],t[1],a[0]-t[0],a[1]-t[1],[0,0,0,0]),e.blend="alpha",U()}function F(e,...t){if(m.events[e])for(const a of m.events[e])a(...t)}function U(){m.state.stack.length>=64||(m.state.offset>0&&(m.state.stack.splice(m.state.stack.length-m.state.offset,m.state.offset),m.state.offset=0),m.state.stack.push({frames:x(),curFrame:m.curFrame}),F("change"))}function I(e){m.frames=e.frames.map(c),A(e.curFrame),F("change")}function O(){m.state.offset>=m.state.stack.length-1||(m.state.offset++,I(m.state.stack[m.state.stack.length-m.state.offset-1]))}function C(){0!==m.state.offset&&(m.state.offset--,I(m.state.stack[m.state.stack.length-m.state.offset-1]))}function x(){return m.frames.map((e=>e.toImageData()))}function S(){m.curAnim=null,m.animTimer=0,m.readOnly=e.readOnly}function K(e){m.curAnim?S():function(e){m.curAnim=e,m.animTimer=0,A(m.anims[e].from),m.readOnly=!0}(e)}w.type="color",w.addEventListener("change",(e=>{const t=function(e){const t=parseInt(e,16);return[t>>16&255,t>>8&255,255&t,255]}(e.target.value.substring(1));m.palette.push(t),D(t),F("change",m.palette)})),u.loopID=window.requestAnimationFrame((function e(o){const n=o-u.time;if(u.time=o,m.gaming&&(m.gameTimer+=n,m.gameTimer>=m.gameSpeed&&(m.frames[m.curFrame]=M().game(),m.gameTimer=0)),m.curAnim&&(m.animTimer+=n,m.animTimer>=m.animSpeed)){const e=m.anims[m.curAnim];e.to<e.from?m.curFrame>e.to?R():A(e.from):m.curFrame<e.to?E():A(e.from),m.animTimer=0}let i=!1,c=!1,v=null;const k=M(),b=f.width,y=f.height,U=m.view.scale,I=m.view.offset[0],O=m.view.offset[1];function C(e,t,a={}){const r=a.lineWidth||2;let s;return{width:e,height:t,update(){s&&(a.click||a.hover)&&function(e,t,a,r){a<0&&(e+=a,a=-a),r<0&&(t+=r,r=-r);const[s,o]=u.mousePos;return s>=e&&s<=e+a&&o>=t&&o<=t+r}(s.x,s.y,e,t)&&(i=!0,a.hover&&a.hover(),u.mousePressed&&!c&&(a.click&&a.click(),c=!0))},draw(){s=d.getTransform().transformPoint(),this.update(),a.bg&&(d.fillStyle=h(a.bg),d.fillRect(0,0,e,t)),a.border&&(d.lineWidth=r,d.strokeStyle=h(a.border),d.strokeRect(0,0,e,t))}}}function x(e,t={}){const a=t.align||"left",r=t.margin||0,s=t.padding||0;let o=0,n=0;for(const h of e)h&&(o=Math.max(h.width,o),n+=h.height+r);const i=o+2*s,c=n+2*s,l=C(i,c,t);return{width:i,height:c,update(){e.reverse().forEach((e=>{e.update()}))},draw(){l.draw(),d.save(),d.translate(s,s),e.forEach((e=>{if(!e)return;const t=(()=>{switch(a){case"left":return 0;case"center":return(o-e.width)/2;case"left":return o-e.width}})();d.translate(t,0),e.draw(),d.translate(-t,e.height+r)})),d.restore()}}}function S(e,t={}){const a=t.align||"top",r=t.margin||0,s=t.padding||0;let o=0,n=0;for(const h of e)h&&(o+=h.width,n=Math.max(h.height,n));const i=o+2*s,c=n+2*s,l=C(i,c,t);return{width:i,height:c,update(){e.reverse().forEach((e=>{e.update()}))},draw(){l.draw(),d.save(),d.translate(s,s),e.forEach((e=>{if(!e)return;const t=(()=>{switch(a){case"top":return 0;case"center":return(n-2*s-e.height)/2;case"bottom":return n-2*s-e.height}})();d.translate(0,t),e.draw(),d.translate(e.width+r,-t)})),d.restore()}}}function Y(e,t={}){const a=t.padding||0,r=t.sw||e.width,s=t.sh||e.height,o=(t.width||r)+2*a,n=(t.height||s)+2*a,i=o+2*a,c=n+2*a,l=t.sx||0,h=t.sy||0,f=(t.lineWidth,C(i,c,t));return{width:i,height:c,update(){f.update()},draw(){f.draw(),d.drawImage(e,l,h,r,s,a,a,o,n)}}}function j(e,t={}){e+="";const s=t.size||12,o=t.padding||0,n=e.length*s+2*o,i=s+2*o,c=t.color||[0,0,0,255],l=(t.lineWidth,C(n,i,t));return{width:n,height:i,update(){l.update()},draw(){l.draw(),d.fillStyle=h(c);const t=e.split("");let n=0;for(const e of t)if(r[e]){const[t,i]=r[e];d.drawImage(a,8*t,8*i,8,8,o+n,o,s,s),n+=s}}}}function J(e,t,a){t||a?function(e,t,a,r={}){return{width:a.width,height:a.height,update(){a.update()},draw(){d.save(),d.translate(e,t),a.draw(),d.restore()}}}(t,a,e).draw():e.draw()}function q(e,t,a,r={}){const s=C(e,t,r);return{width:e,height:t,update(){a.reverse().forEach((([e])=>{e.update()}))},draw(){s.draw(),a.forEach((([e,[t,a]])=>{d.save(),d.translate(t,a),e.draw(),d.restore()}))}}}const L=C(b,y,{bg:[170,170,170,255]}),T=S([...m.frames.map(((e,t)=>{const a=t===m.curFrame;return j(t,{padding:a?6:3,bg:a?[255,255,255,255]:[230,230,230,255],border:[0,0,0,255],size:16,click(){A(t)}})})),!m.readOnly&&j("+",{padding:3,bg:[230,230,230,255],border:[0,0,0,255],size:16,click(){P()}})],{align:"bottom"}),V=C(k.width()*U,k.height()*U,{bg:[255,255,255,255]}),G=C(k.width()*U,k.height()*U,{border:[0,0,0,255]});function N(e,t={}){const a=t.dx||0,r=t.dy||0;return{width:e.width()*U,height:e.height()*U,draw(){d.save(),d.scale(U,U),d.translate(a,r),d.drawImage(e.drawable(),0,0),d.restore()}}}if(q(b,y,[[L,[0,0]],[V,[I,O]],[N(k),[I,O]],[(()=>{if("move"===m.tool&&u.mouseStartPos){const[e,t]=p(u.mousePos),[a,r]=p(u.mouseStartPos),[s,o]=[e-a,t-r];return N(m.fCanvas,{dx:s,dy:o})}return N(m.fCanvas)})(),[I,O]],[T,[I,O-T.height]],[G,[I,O]]]).draw(),k.scissorRect){const e=k.scissorRect[0],t=k.scissorRect[1];d.lineDashOffset=o/100,d.strokeStyle=h([0,0,0,255]),d.setLineDash([5,5]),d.strokeRect(e[0]*U+I,e[1]*U+O,(t[0]-e[0])*U,(t[1]-e[1])*U),d.strokeStyle=h([255,255,255,255]),d.setLineDash([0,5,5,0]),d.strokeRect(e[0]*U+I,e[1]*U+O,(t[0]-e[0])*U,(t[1]-e[1])*U),d.setLineDash([])}if(!m.readOnly){const[e,t]=p(u.mousePos),a=e*U+I,r=t*U+O;if(k.checkPt(e,t))switch(m.tool){case"pen":case"rect":case"line":case"circle":case"bucket":J(C(U,U,{bg:m.color}),a,r);break;case"erasor":J(C(U,U,{bg:[255,255,255,255],border:[0,0,0,255]}),a,r)}}const H={padding:3,size:16,bg:[255,255,255,255],border:[0,0,0,255]},Q=x([...m.palette.map((e=>C(24,24,{bg:e,border:[0,0,0,255],lineWidth:l(e,m.color)?4:2,click(){D(e)}}))),j("+",{size:24,bg:[255,255,255,255],border:[0,0,0,255],click(){w.click()}})]),W=x([...Object.keys(s).map((e=>{const a=s[e];return Y(t,{sx:16*a.icon,sw:16,sh:16,width:32,height:32,bg:[255,255,255,255],border:[0,0,0,255],lineWidth:m.tool===e?4:2,click(){m.tool=e},hover(){v={msg:`${e} (${a.key})`,pos:[-1,1]}}})}))]),X=S([...Object.keys(g).map((e=>{const a=g[e];return Y(t,{sx:16*a.icon,sw:16,sh:16,width:32,height:32,bg:[255,255,255,255],border:[0,0,0,255],click(){a.action()},hover(){v={msg:`${e}`,pos:[-1,-1]}}})}))]),B=x([!m.readOnly&&j("+",{...H,click(){const e=prompt("add anim:");e&&(m.anims[e]={from:0,to:0,loop:!0},F("change"))}}),...Object.keys(m.anims).map((e=>{const t=m.anims[e],a=e===m.curAnim;return S([j((a?">":"")+e,{...H,lineWidth:a?4:2,click(){K(e)}}),j(t.from,{...H,lineWidth:a?4:2,click(){t.from=(t.from+1)%m.frames.length,F("change")}}),j(t.to,{...H,lineWidth:a?4:2,click(){t.to=(t.to+1)%m.frames.length,F("change")}})])}))]);if(u.hideUI||function(e,t,a,r={}){return q(e,t,a.filter((e=>e)).map((([a,r])=>[a,[r[0]*(e-a.width),r[1]*(t-a.height)]])),r)}(b,y,[!m.readOnly&&[Q,[0,0]],!m.readOnly&&[W,[1,0]],!m.readOnly&&[X,[1,1]],[B,[0,1]]]).draw(),v){const e=6,[t,a]=u.mousePos,r=j(v.msg,{padding:3,bg:[255,255,255,255],border:[0,0,0,255]});J(r,t+(r.width*(v.pos[0]-1)/2+v.pos[0]*e),a+(r.height*(v.pos[1]-1)/2+v.pos[1]*e))}if(i?f.style.cursor="pointer":u.grabbin?f.style.cursor="grab":f.style.cursor=s[m.tool].cursor,u.mousePressed&&!c){const[e,t]=p(u.mousePos);if(u.mouseDown=!0,!m.readOnly)switch(m.tool){case"pen":k.set(e,t,m.color);break;case"erasor":k.blend="replace",k.set(e,t,[0,0,0,0]),k.blend="alpha";break;case"bucket":k.bucket(e,t,m.color);break;case"move":k.scissorRect&&(m.fCanvas.scissorRect=k.scissorRect,m.fCanvas.merge(k),m.fCanvas.scissorRect=null,z());break;case"eyedropper":m.color=k.get(e,t)}}u.mousePressed=!1,u.loopID=window.requestAnimationFrame(e)}));const Y={wheel(e){e.preventDefault(),e.altKey?e.deltaY<0?k():e.deltaY>0&&v():(m.view.offset[0]-=e.deltaX,m.view.offset[1]-=e.deltaY)},mousedown(e){u.mousePressed=!0,u.mousePosPrev=[...u.mousePos],u.mousePos=[e.offsetX,e.offsetY],u.mouseStartPos=[...u.mousePos]},mousemove(e){if(m.readOnly)return;if(u.mousePosPrev=[...u.mousePos],u.mousePos=[e.offsetX,e.offsetY],u.mouseMoved=!0,u.grabbin&&(m.view.offset[0]+=e.movementX,m.view.offset[1]+=e.movementY),!u.mouseDown)return;const t=M(),[a,r]=p(u.mousePos),[s,o]=p(u.mousePosPrev),[n,i]=p(u.mouseStartPos);switch(m.tool){case"pen":t.line(s,o,a,r,m.color);break;case"erasor":t.blend="replace",t.line(s,o,a,r,[0,0,0,0]),t.blend="alpha";break;case"rect":m.fCanvas.clear(),m.fCanvas.fillRect(n,i,a-n,r-i,m.color);break;case"line":m.fCanvas.clear(),m.fCanvas.line(n,i,a,r,m.color);break;case"circle":m.fCanvas.clear(),m.fCanvas.fillCircle(n,i,Math.max(a-n,r-i),m.color);break;case"select":{const[e,s]=t.clampPt([n,i]),[o,c]=t.clampPt([a,r]);t.scissorRect=[[e,s],[o,c]];break}case"move":{const[e,n]=[a-s,r-o];t.scissorRect[0][0]+=e,t.scissorRect[1][0]+=e,t.scissorRect[0][1]+=n,t.scissorRect[1][1]+=n;break}}},mouseup(e){if(m.readOnly)return;u.mouseDown=!1,u.mousePosPrev=[u.mousePos,u.mousePos],u.mousePos=[e.offsetX,e.offsetY];const t=M(),[a,r]=p(u.mousePos);if(!u.mouseStartPos)return;const[s,o]=p(u.mouseStartPos);switch(u.mouseStartPos=null,m.tool){case"pen":case"erasor":case"bucket":U();break;case"rect":case"circle":case"line":t.merge(m.fCanvas),m.fCanvas.clear(),U();break;case"move":if(t.scissorRect){const[e,n]=[a-s,r-o];t.merge(m.fCanvas,e,n),m.fCanvas.clear(),U()}}},keydown(t){if(!t.metaKey)for(const e in s){if(s[e].key===t.key)return void(m.tool=e)}const a=M();switch(t.key){case"-":v();break;case"=":k();break;case"0":b();break;case"ArrowLeft":R();break;case"ArrowRight":E();break;case" ":u.grabbin=!0,t.preventDefault();break;case"Escape":S(),m.gaming=!1,m.gameTimer=0,m.readOnly=e.readOnly,O()}if(!m.readOnly)switch(t.key){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":D(m.palette[parseInt(t.key,10)-1]||m.color);break;case"+":P();break;case"_":y();break;case"z":t.metaKey&&(t.preventDefault(),t.shiftKey?C():O());break;case"s":t.metaKey&&(t.preventDefault(),F("save"));break;case"l":t.metaKey&&(t.preventDefault(),F("load"));break;case"Backspace":a.scissorRect?(z(),a.scissorRect=null):u.delCb();break;case"Escape":a.scissorRect=null;break;case"Tab":t.preventDefault(),u.hideUI=!u.hideUI}},keyup(e){if(" "===e.key)u.grabbin=!1}};f.onselectstart=()=>!1;for(const L in Y)f.addEventListener(L,Y[L]);function M(){return m.frames[m.curFrame]}function j(){return{version:"1",width:m.width,height:m.height,palette:m.palette,anims:m.anims,frames:m.frames.map((e=>e.toDataURL()))}}function J(e){return m.width=e.width,m.height=e.height,m.palette=e.palette,m.anims=e.anims,b(),Promise.all(e.frames.map(((e,t)=>i(e).then((e=>{m.frames[t]=e}))))).then((()=>{m.frames.length=e.frames.length,m.curFrame>=m.frames.length&&A(m.frames.length-1)}))}function q(e,...t){const a=URL.createObjectURL(new Blob(...t)),r=document.createElement("a");r.href=a,r.download=e,r.click()}return m.state.stack=[{frames:x(),curFrame:m.curFrame}],e.data&&J(e.data),{frames:function(){return m.frames},curFrame:M,on:function(e,t){m.events[e]||(m.events[e]=[]),m.events[e].push(t)},setTool:function(e){if(!s[e])throw new Error(`no tool called ${e} bro`);m.tool=e},setColor:D,setPalette:function(e){m.palette=e},save:j,load:J,undo:O,redo:C,pushState:U,scaleUp:k,scaleDown:v,scaleFit:b,newFrame:P,delFrame:y,prevFrame:R,nextFrame:E,download:function(e){q(e,[JSON.stringify(j())])},downloadPNG:function(e){q(e,[M().toPNG()])},cleanUp:function(){for(const e in Y)f.removeEventListener(e,Y[e]);window.cancelAnimationFrame(u.loopID)}}}}}]);
//# sourceMappingURL=4837-1353bb3ed3ca6655.js.map
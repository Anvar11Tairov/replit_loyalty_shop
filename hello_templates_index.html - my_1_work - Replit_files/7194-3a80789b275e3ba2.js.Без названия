"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7194],{98467:function(e,r,t){t.d(r,{F:function(){return l}});var n=t(10253),o=t(78120),i=t(37529),a=t.n(i);function l(e,r){if(e===r)return o.as.empty(e.length);var t,i=0,l=[];return a()(e,r).forEach((function(e){var r=(0,n.Z)(e,2),o=r[0],s=r[1];switch(o){case a().INSERT:(null===t||void 0===t?void 0:t.to)===i?t.insert=t.insert?t.insert+s:s:(t={from:i,insert:s},l.push(t));break;case a().DELETE:(null===t||void 0===t?void 0:t.to)===i?t.to+=s.length:(t={from:i,to:i+s.length},l.push(t)),i+=s.length;break;case a().EQUAL:i+=s.length}})),o.as.of(l,e.length)}},87194:function(e,r,t){t.d(r,{Z:function(){return ee}});var n=t(47568),o=t(26042),i=t(69396),a=t(29815),l=t(70655),s=t(65456),c=t(58794),u=t(48551),f=t(15583),d=t(31066),h=t(50055),p=t(4111),v=t(51438),m=t(28668),y=t(25171),g=t(17187),w=t(34606),C=t(51207),E=t(91296),D=t.n(E),k=t(21603),b=t(60977),F=t(10253),_=t(35642),S={replsList:function(){return"dataLossRepls"},replFiles:function(e){return"dataLossReplFiles".concat(e)},latestOp:function(e,r){return"dataLossLatestOp--".concat(e,"--").concat(r)},latestFlushedOp:function(e,r){return"dataLossLatestFlushed--".concat(e,"--").concat(r)},latestOwnOp:function(e,r){return"dataLosslatestOwnOp--".concat(e,"--").concat(r)}};function x(e,r){var t={latestOp:null,latestFlushedOp:null,latestOwnOp:null},n=Object.keys(t),o=!0,i=!1,a=void 0;try{for(var l,s=n[Symbol.iterator]();!(o=(l=s.next()).done);o=!0){var c=l.value,u=_.Z.get(S[c](e,r),"object");u&&(u&&"object"===typeof u&&"number"===typeof u.crc32&&"number"===typeof u.version&&(t[c]=u))}}catch(f){i=!0,a=f}finally{try{o||null==s.return||s.return()}finally{if(i)throw a}}return t}function O(){var e=_.Z.get(S.replsList(),"array");return e||(e=[],_.Z.set(S.replsList(),e)),e}function T(e){var r=_.Z.get(S.replFiles(e),"array");return r||(r=[],_.Z.set(S.replFiles(e),r)),r}function Z(e){var r=T(e),t=!0,n=!1,o=void 0;try{for(var i,a=r[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var l=i.value;"string"===typeof l&&R(e,l)}}catch(c){n=!0,o=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}_.Z.remove(S.replFiles(e));var s=O().filter((function(r){return r!==e}));_.Z.set(S.replsList(),s)}function R(e,r){_.Z.remove(S.latestOp(e,r)),_.Z.remove(S.latestFlushedOp(e,r)),_.Z.remove(S.latestOwnOp(e,r));var t=T(e).filter((function(e){return e!==r}));_.Z.set(S.replFiles(e),t)}function L(e){var r=e.replId,t=e.filePath;!function(e){var r=O();r.includes(e)||(r.length>20?(Z(r[0]),r[0]=e):r.push(e),_.Z.set(S.replsList(),r))}(r);var n=T(r);n.includes(t)||(n.length>20?(Z(n[0]),n[0]=t):n.push(t),_.Z.set(S.replFiles(r),n))}function P(e){var r=e.filePath,t=e.replId,n=e.opType,o=e.op;_.Z.set(S[n](t,r),o)}var M={};function I(e){return N.apply(this,arguments)}function N(){return N=(0,n.Z)((function(e){var r,t,o,i,a,s,c;return(0,l.__generator)(this,(function(u){return r=e.filePath,t=e.replId,o=e.serverVersion,i=e.serverContent,a=e.fetchOps,M[r+t]||(M[r+t]=!0,s=x(t,r),c=w.str(i)>>>0,Object.keys(s).forEach(function(){var e=(0,n.Z)((function(e){var r,t,n;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:if(!(r=s[e]))return[2];if(o<r.version)return k.kg.info("ot client dataloss",{opType:e,case:"server_forgot"}),[2];if(o===r.version)return c!==r.crc32&&k.kg.info("ot client dataloss",{opType:e,case:"crc32_mistmach"}),[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,a(r.version,r.version)];case 2:return n=F.Z.apply(void 0,[i.sent(),1]),t=n[0],[3,4];case 3:return i.sent(),k.kg.info("ot client dataloss",{opType:e,case:"error_fetching_op"}),[2];case 4:return t?(t.crc32!==r.crc32&&k.kg.info("ot client dataloss",{opType:e,case:"crc32_mismatch"}),[2]):(k.kg.info("ot client dataloss",{opType:e,case:"op_not_found"}),[2])}}))}));return function(r){return e.apply(this,arguments)}}())),[2]}))})),N.apply(this,arguments)}var A=t(10449);function B(e,r){var t=!0,n=!1,o=void 0;try{for(var i,a=r[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var l=i.value;switch(l){case s.Df.NotFound:if(e.includes("no such file"))return s.Df.NotFound;if(e.includes("file does not exist"))return s.Df.NotFound;break;case s.Df.AlreadyExists:if(e.includes("file exist"))return s.Df.AlreadyExists;break;case s.Df.NotDirectory:if(e.includes("not a directory"))return s.Df.NotDirectory;break;case s.Df.IsDirectory:if(e.includes("is a directory"))return s.Df.IsDirectory;break;case s.Df.DiskQuotaExceeded:if(e.includes("disk quota exceeded"))return s.Df.DiskQuotaExceeded;break;default:(0,A.Z)(l)}}}catch(c){n=!0,o=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}return null}var U=t(78120);function V(e){return e.map((function(e){if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"===typeof e.insert)return e.insert;throw new Error("Unexpected op type")}))}function Q(e,r){var t,n=[],o=r,i=0,a=0,l=0,s=0,c=function(e){for(var t=a+l;t<a+e+l;t++){var n=r.charCodeAt(t);n>=55296&&n<=57343?(l++,t++):13===n&&10===r.charCodeAt(t+1)&&(s++,t++)}a+=e},u=!0,f=!1,d=void 0;try{for(var h,p=e[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var v=h.value;if("string"===typeof v){var m=v;o=o.slice(0,i)+m+o.slice(i),i+=m.length;var y=a+l;if(m.endsWith("\r")&&"\n"===r.slice(y,y+1)&&0===(m=m.slice(0,-1)).length)continue;var g=j(m),w=y-s;(null===t||void 0===t?void 0:t.to)===w?t.insert=t.insert?t.insert.append(g):g:(t={from:y-s,insert:g},n.push(t))}else if("number"===typeof v){var C=l;c(v),i+=v+(l-C)}else if("d"in v){var E=a+l,D=s;c(v.d);var k=a+l,b=k-E;o=o.slice(0,i)+o.slice(i+b);var F=E-D,_=k-s;if("\r\n"===r.slice(E-1,E+1)&&(_-=1)-(F+=1)<=0)continue;(null===t||void 0===t?void 0:t.to)===F?t.to=_:(t={from:F,to:_},n.push(t))}}}catch(x){f=!0,d=x}finally{try{u||null==p.return||p.return()}finally{if(f)throw d}}if(a+l!==r.length){var S=r.slice(a+l);s+=S.split("\r\n").length-1}return{changes:U.as.of(n,r.length-s),docAfter:o}}var q=/\r\n?|\n/;function W(e){return e.replace(new RegExp(q,"g"),"\n")}function j(e){return U.xv.of(e.split(q))}var $=function(e){(0,m.Z)(t,e);var r=(0,y.Z)(t);function t(e,a,u){var f;(0,v.Z)(this,t),(f=r.call(this)).writeChanges=function(e,r){if(!f.channel&&!f.isReconnecting)throw new Error("Trying to send changes before ever coming online");f.isReconnecting&&(f.didEditOffline=!0);var t=function(e,r){var t=[],n=r,o=0,i=0,a=0,l=0,s=function(e){var t=e-i;if(e<i)throw new Error("expected changeset to be ordered");for(var n=i+a;n<i+t+a;n++){var o=r.charCodeAt(n);o>=55296&&o<=57343?(l++,n++):13===o&&10===r.charCodeAt(n+1)&&(a++,n++)}i+=t};return e.iterChanges((function(e,r,c,u,f){if(e>0){var d=i+a,h=d-l;s(e);var p=i+a,v=p-l;t.push(v-h),o+=p-d}if(e!==r){var m=i+a,y=m-l;s(r);var g=i+a,w=g-l;t.push({d:w-y});var C=g-m;n=n.slice(0,o)+n.slice(o+C)}if(f.length){var E=f.sliceString(0);t.push(E),n=n.slice(0,o)+E+n.slice(o),o+=E.length}})),{op:t,docAfter:n}}(e,f.localContent),n=t.op,i=t.docAfter;if(Math.random()<.1){var a=W(C.dt.apply(f.localContent,n)),l=e.apply(j(f.localContent));a===l.sliceString(0)&&a===W(i)||f.onError("changeset to op mismatch",{originalError:null,changes:e,otContent:a,changeSetContent:l,docAfter:i})}var s,c="ghostwriter"===(null===(s=r)||void 0===s?void 0:s.author)?{author:h.api.OTPacket.Author.GHOSTWRITER}:{};f.metadata=(0,o.Z)({},f.metadata,c),f.pending=C.dt.compose(f.pending,n),f.localContent=i,0!==f.pending.length?f.emit("fileDirty"):f.commitPromise&&f.emit("commitStart"),f.debounceSend()},f.updateCursors=function(e){f.pendingCursors=e,f.debounceSend()},f.isClean=function(){return f.committedVersion===f.version&&0===f.inflight.length&&0===f.pending.length},f.onError=function(e,r){if(r.originalError){var t="string"===typeof r.originalError?r.originalError:r.originalError.message,n=B(t,[s.Df.NotFound,s.Df.IsDirectory,s.Df.DiskQuotaExceeded]);if(n)return void f.emit("fsError",n,t)}f.destroy();var a=new Error("OT Error: "+e);f.emit("error",a,(0,i.Z)((0,o.Z)({},r),{filePath:f.linkedFile,version:f.version}))},f.sendOp=function(){if(f.channel&&"open"===f.channel.status&&!f.isReconnecting&&!(f.inflight.length>0)){if(0!==f.pending.length){var e=f.pending.map((function(e){return"object"===typeof e?{delete:e.d}:"number"===typeof e?{skip:e}:{insert:e}}));f.inflight=f.pending,f.pending=[],f.inflightOpsPromise=f.channel.request({ot:(0,o.Z)({spookyVersion:f.version,op:e},f.metadata)}),f.metadata={},f.inflightOpsPromise.then((function(r){r.error&&f.onError("error accepting packet",{originalError:r.error,op:e})}))}if(0!==f.pendingCursors.length){var r=!0,t=!1,n=void 0;try{for(var i,a=f.flushedCursorIds[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var l=i.value;f.channel.send({otDeleteCursor:{id:l}})}}catch(m){t=!0,n=m}finally{try{r||null==a.return||a.return()}finally{if(t)throw n}}f.flushedCursorIds=[];var s=!0,c=!1,u=void 0;try{for(var d,h=f.pendingCursors[Symbol.iterator]();!(s=(d=h.next()).done);s=!0){var p=d.value,v=Number(Math.random().toString().split(".")[1]).toString(36);f.flushedCursorIds.push(v),f.channel.send({otNewCursor:(0,o.Z)({id:v,user:f.user},p)})}}catch(m){c=!0,u=m}finally{try{s||null==h.return||h.return()}finally{if(c)throw u}}f.pendingCursors=[]}}},f.handlePacket=function(e,r){var t=e.op,n=e.version,o=e.crc32,i=r.overrideReconnectingBuffer;if(!f.isReconnecting||i)if(-1!==f.version){if(f.version++,n!==f.version){var a={originalError:null,expectedVersion:f.version,receivedVersion:n,incomingOp:t};return k.kg.error("OT Error: invalid server version",(0,k.P1)({details:a})),void f.onError("invalid server version",a)}try{f.serverContent=C.dt.apply(f.serverContent,t)}catch(y){return void f.onError("unable to apply updated content",{originalError:y,incomingOp:t})}var l=w.str(f.serverContent)>>>0;if(l!==o){var s={originalError:null,incomingVersion:n,server:o,client:l,incomingOp:t};return k.kg.error("OT Error: crc32 mismatch",(0,k.P1)({details:s})),void f.onError("crc32 mismatch",s)}if(f.uncommittedOps.push({version:n,crc32:o,op:t}),f.shouldTrackDataLoss&&P({replId:f.replId,filePath:f.linkedFile,opType:"latestOp",op:{version:n,crc32:o}}),JSON.stringify(t)===JSON.stringify(f.inflight))return f.shouldTrackDataLoss&&P({replId:f.replId,filePath:f.linkedFile,opType:"latestOwnOp",op:{version:n,crc32:o}}),f.debounceCommit(),f.inflight=[],f.inflightOpsPromise=null,f.debounceSend(),void f.debounceSend.flush();if(f.commitPromise||f.emit("fileDirty"),f.debounceCommit(),f.hasUncommittedMultiplayerOps=!0,f.inflight.length){var c=C.dt.transform(f.inflight,t,"right");t=C.dt.transform(t,f.inflight,"left"),f.inflight=c}if(f.pending.length){var u=C.dt.transform(f.pending,t,"right");t=C.dt.transform(t,f.pending,"left"),f.pending=u}var d=Q(t,f.localContent),h=d.changes,p=d.docAfter;if(Math.random()<.1){var v=W(C.dt.apply(f.localContent,t)),m=h.apply(j(f.localContent));v===m.sliceString(0)&&v===W(p)||f.onError("op to changeset mismatch",{originalError:null,op:t,otContent:v,changeSetContent:m,docAfter:p})}f.localContent=p,f.emit("changes",h)}else f.onError("Got packet while version is still -1, expected version to be set in handleStatus",{originalError:null});else f.bufferedReconnectingOps.push({crc32:o,op:t,version:n})},f.handleNewCursor=function(e){f.emit("cursor",e)},f.handleDeleteCursor=function(e){var r=e.id;f.emit("removeCursor",r)};var d=(0,p.Z)(f);f.handleStatus=function(){var e=(0,n.Z)((function(e){var r,t,n,o,i;return(0,l.__generator)(this,(function(a){switch(a.label){case 0:return d.channel&&"open"===d.channel.status?e.linkedFile?null==e.contents?(d.onError("expected status contents, got null or undefined",{originalError:null}),[2]):null==e.cursors?(d.onError("expected status cursors, got null or undefined",{originalError:null}),[2]):null==e.version?(d.onError("expected status version, got null or undefined",{originalError:null}),[2]):d.isReconnecting?(d.handleReconnect(e.contents,e.version),[2]):(d.shouldTrackDataLoss&&I({serverContent:e.contents,serverVersion:e.version,replId:d.replId,filePath:d.linkedFile,fetchOps:d.fetchOps}),d.serverContent=e.contents,d.localContent=d.serverContent,d.version=e.version,d.emit("firstConnect"),d.emit("changes",U.as.of({from:0,insert:d.serverContent},0)),e.cursors.forEach(d.handleNewCursor),d.emit("fileDirty"),d.debounceCommit(),[2]):[4,d.channel.request({otLinkFile:{file:{path:d.linkedFile}}})]:[2];case 1:return(t=a.sent()).channelClosed?[2]:t.error?(d.onError("link file error "+t.error.replace(d.linkedFile,"$FILENAME"),{originalError:t.error}),[2]):t.otLinkFileResponse?(n=t.otLinkFileResponse.version,i=c.Z.from(null!==(o=null===(r=t.otLinkFileResponse.linkedFile)||void 0===r?void 0:r.content)&&void 0!==o?o:"").toString(),d.isReconnecting?(d.handleReconnect(i,n),[2]):(d.shouldTrackDataLoss&&I({serverContent:i,serverVersion:n,replId:d.replId,filePath:d.linkedFile,fetchOps:d.fetchOps}),d.serverContent=i,d.localContent=d.serverContent,d.version=n,d.committedVersion=n,d.committedContent=d.serverContent,d.emit("firstConnect"),d.emit("changes",U.as.of({from:0,insert:d.serverContent},0)),[2])):(d.onError("unexpected link file response: "+JSON.stringify(t.toJSON()),{originalError:null}),[2])}}))}));return function(r){return e.apply(this,arguments)}}();var m=(0,p.Z)(f);f.handleReconnect=function(){var e=(0,n.Z)((function(e,r){var t,n,a,s,c,u,f,d,h,p,v,y,g,w,E,D,F,_,S,x,O,T,Z,R,L,P,M,I,N,A,B,U,V,Q,q,W,j,$,J,K,Y,z,G,H,X,ee,re,te,ne,oe,ie;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(!m.timeDisconnected)throw new Error("wat");if(t=Date.now()-m.timeDisconnected,n={case:"other",remoteContent:e,localContent:m.localContent},a=function(n){m.reconnectTrackedData=(0,i.Z)((0,o.Z)({},n),{serverVersion:r,ourVersion:m.version,ourCommittedVersion:m.committedVersion,areContentsEqual:m.serverContent===e,areCommittedContentsEqual:m.committedContent===e,didReceiveOpsWhileReconnecting:Boolean(m.bufferedReconnectingOps.length),didEditOffline:m.didEditOffline,hasPendingOps:Boolean(m.pending.length),disconnectDuration:t}),k.kg.info("OT Client: Reconnect",(0,k.P1)((0,o.Z)({},m.reconnectTrackedData))),(0,b.j)(b.U3.FILE_RECONNECTED_STATUS2,m.reconnectTrackedData)},s=function(e,r){a({case:e,originCase:r,prompted:!1}),m.isReconnecting=!1,m.bufferedReconnectingOps=[],m.didEditOffline=!1,m.timeDisconnected=null,m.debounceSend(),m.debounceCommit(),m.emit("transparentReconnect",{case:e,originCase:r})},c=function(t){if(n.remoteContent===n.localContent)return m.version=r,m.committedVersion=r,m.localContent=e,m.committedContent=e,m.inflight=[],m.pending=[],void s("unprompted_because_identical",t);a({case:t,prompted:!0}),n.case=t,m.emit("promptUserReconnect",n)},m.inflight.length){if(r===m.version&&m.serverContent===e)return m.pending=C.dt.compose(m.inflight,m.pending),m.inflight=[],m.inflightOpsPromise=null,s("has_inflight_happy_path_ops_unreached"),[2];u=!1,f=m.serverContent;try{f=C.dt.apply(f,m.inflight)}catch(ae){u=!0}return u||m.version+1!==r||f!==e?(c("has_inflight"),[2]):(c("has_inflight_happy_path_ops_reached"),[2])}if(m.hasUncommittedMultiplayerOps)return c("multiplayer"),[2];if(m.version===r)return e===m.serverContent?(s("happy_path"),[2]):(c("same_version_different_content"),[2]);if(m.committedVersion===r){d=e;try{h=!0,p=!1,v=void 0;try{for(y=m.uncommittedOps[Symbol.iterator]();!(h=(g=y.next()).done);h=!0)w=g.value.op,d=C.dt.apply(d,w)}catch(le){p=!0,v=le}finally{try{h||null==y.return||y.return()}finally{if(p)throw v}}}catch(se){return c("same_committed_version_unable_to_apply_ops"),[2]}if(d===m.serverContent){E=[],D=!0,F=!1,_=void 0;try{for(S=m.uncommittedOps[Symbol.iterator]();!(D=(x=S.next()).done);D=!0)O=x.value.op,E=C.dt.compose(E,O)}catch(le){F=!0,_=le}finally{try{D||null==S.return||S.return()}finally{if(F)throw _}}return m.pending=C.dt.compose(E,m.pending),m.uncommittedOps=[],m.version=r,m.serverContent=e,s("happy_path_uncommitted"),[2]}return c("same_committed_version_different_content_fixed"),[2]}return m.version<r?[4,m.fetchOps(m.version+1,r)]:[3,3];case 1:T=l.sent(),Z=!1,R=m.serverContent;try{L=!0,P=!1,M=void 0;try{for(I=T[Symbol.iterator]();!(L=(N=I.next()).done);L=!0)A=N.value.op,R=C.dt.apply(R,A)}catch(le){P=!0,M=le}finally{try{L||null==I.return||I.return()}finally{if(P)throw M}}}catch(ce){Z=!0}if(!Z&&R===e){B=!0,U=!1,V=void 0;try{for(Q=T[Symbol.iterator]();!(B=(q=Q.next()).done);B=!0)W=q.value,m.handlePacket(W,{overrideReconnectingBuffer:!0})}catch(le){U=!0,V=le}finally{try{B||null==Q.return||Q.return()}finally{if(U)throw V}}j=!0,$=!1,J=void 0;try{for(K=m.bufferedReconnectingOps[Symbol.iterator]();!(j=(Y=K.next()).done);j=!0)z=Y.value,m.handlePacket(z,{overrideReconnectingBuffer:!0})}catch(le){$=!0,J=le}finally{try{j||null==K.return||K.return()}finally{if($)throw J}}return s("happy_path_server_ahead"),[2]}return[4,m.fetchOps(m.committedVersion+1,r)];case 2:G=l.sent(),H=!1,X=m.committedContent;try{ee=!0,re=!1,te=void 0;try{for(ne=G[Symbol.iterator]();!(ee=(oe=ne.next()).done);ee=!0)ie=oe.value.op,X=C.dt.apply(X,ie)}catch(le){re=!0,te=le}finally{try{ee||null==ne.return||ne.return()}finally{if(re)throw te}}}catch(ue){H=!0}return H||X!==e?(c("uncommitted_server_ahead"),[2]):(c("happy_path_uncommitted_server_ahead"),[2]);case 3:return c("other"),[2]}}))}));return function(r,t){return e.apply(this,arguments)}}();var y=(0,p.Z)(f);f.flush=(0,n.Z)((function(){return(0,l.__generator)(this,(function(e){switch(e.label){case 0:return[4,y.commitPromise];case 1:return e.sent(),y.debounceCommit(),y.debounceCommit.flush(),[4,y.commitPromise];case 2:return e.sent(),[2]}}))}));var g=(0,p.Z)(f);f.fetchOps=function(){var e=(0,n.Z)((function(e,r){var t;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:if(!g.channel)throw new Error("No channel, cannot fetchOps");return[4,g.channel.request({otFetchRequest:{versionFrom:e,versionTo:r}})];case 1:if((t=n.sent()).channelClosed)throw new Error("Channel closed while requesting");if(t.error)throw new Error("Fetch ops returned an error: "+t.error);if(!t.otFetchResponse)throw new Error("Expected otFetchResponse");if(!t.otFetchResponse.packets)throw new Error("Expected otFetchResponse.packets");return[2,t.otFetchResponse.packets.map((function(e){var r=e.crc32,t=e.op,n=e.version,o=e.userId,i=e.committed,a=e.author;if(null==r)throw new Error("Expected crc32 in packet");if(null==t)throw new Error("Expected op in packet");if(null==n)throw new Error("Expected version in packet");return{crc32:r,version:n,op:V(t),userId:o,timestamp:i?1e3*i.seconds:0,author:a}}))]}}))}));return function(r,t){return e.apply(this,arguments)}}();var E=(0,p.Z)(f);f.fetchChanges=function(){var e=(0,n.Z)((function(e,r,t){var n,o;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,E.fetchOps(e,r)];case 1:return n=i.sent(),o=t,[2,n.map((function(e){var r=e.op,t=e.version,n=e.userId,i=e.timestamp,a=e.crc32,l=Q(r,o),s=l.changes,c=l.docAfter,u=s.invert(j(o));return o=c,{changes:s,invertedChanges:u,userId:n,version:t,timestamp:i,crc32:a}}))]}}))}));return function(r,t,n){return e.apply(this,arguments)}}();var F=(0,p.Z)(f);f.transformSelection=function(){var e=(0,n.Z)((function(e){var r,t,n,o,i,a,s,c;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(r=e.indexStart,t=e.indexEnd,n=e.versionFrom,o=e.versionTo,!F.channel)throw new Error("No channel, cannot transformSelection");return[4,F.channel.request({otTransformSelectionRequest:{indexStart:r,indexEnd:t,versionFrom:n,versionTo:o}})];case 1:if(!(i=l.sent()).otTransformSelectionResponse)throw new Error("Expected otTransformSelectionResponse");return[2,{indexStart:null!==(a=i.otTransformSelectionResponse.indexStart)&&void 0!==a?a:0,indexEnd:null!==(s=i.otTransformSelectionResponse.indexEnd)&&void 0!==s?s:0,version:null!==(c=i.otTransformSelectionResponse.version)&&void 0!==c?c:0}]}}))}));return function(r){return e.apply(this,arguments)}}(),f.getLocalContent=function(){return W(f.localContent)},f.getRawLocalContent=function(){return f.localContent},f.shouldTrackDataLoss=!1,f.replId="",f.linkedFile=e,f.channel=null,f.inflight=[],f.inflightOpsPromise=null,f.uncommittedOps=[],f.hasUncommittedMultiplayerOps=!1,f.committedVersion=-1,f.isReconnecting=!1,f.bufferedReconnectingOps=[],f.didEditOffline=!1,f.pending=[],f.metadata={},f.version=-1,f.serverContent="",f.localContent="",f.committedContent="",f.flushedCursorIds=[],f.pendingCursors=[],f.user=null,f.flushFailed=0,f.debounceSend=D()((function(){return f.sendOp()}),20,{maxWait:60}),f.debounceCommit=D()((function(){return f.commitToDisk()}),1e3,{maxWait:3e3}),f.commitPromise=null,f.timeDisconnected=null;var _=!1;return f.destroy=function(){_=!0},u.then((function(){_||(f.destroy=a.openChannel({service:"ot",name:"ot:".concat(e)},(function(r){if(!r.error){var t=r.channel,n=r.context;return f.shouldTrackDataLoss=!window.navigator.userAgent.includes("Firefox"),f.replId=n.repl.id,f.shouldTrackDataLoss&&L({replId:f.replId,filePath:e}),f.user=n.currentUser?{name:n.currentUser.username,id:n.currentUser.id}:null,f.channel=t,t.onCommand((function(e){switch(e.body){case"ot":var r,t,n;if(!e.ot||null==e.ot.op||null==e.ot.spookyVersion||null==e.ot.crc32)return void f.onError("missing data in ot packet",{originalError:null,op:null===(r=e.ot)||void 0===r?void 0:r.op,spookyVersion:null===(t=e.ot)||void 0===t?void 0:t.spookyVersion,crc32:null===(n=e.ot)||void 0===n?void 0:n.crc32});if(-1===f.version)return;var o={crc32:e.ot.crc32,op:V(e.ot.op),version:e.ot.spookyVersion};return f.handlePacket(o,{overrideReconnectingBuffer:!1});case"otstatus":return f.handleStatus(e.otstatus);case"error":if(e.ref)return;return f.onError("Unknown protocol error OT channel",{originalError:e.error||"no error"});case"otNewCursor":return f.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return f.handleDeleteCursor(e.otDeleteCursor)}})),function(){f.channel=null,f.isReconnecting=!0,f.debounceSend.cancel(),f.debounceCommit.cancel(),f.timeDisconnected||(f.timeDisconnected=Date.now())}}})))})),f}return t.prototype.commitToDisk=function(){var e=this;return(0,n.Z)((function(){var r,t,n,o,i,a;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(!e.channel)throw new Error("Tryna commit while offline");if("open"!==e.channel.status)return[2];if(e.isReconnecting)throw new Error("Committing while reconnecting");return e.isClean()?[2]:e.commitPromise?(e.debounceCommit(),[2]):(r=function(){},e.commitPromise=new Promise((function(e){return r=e})),e.inflightOpsPromise?[4,e.inflightOpsPromise]:[3,2]);case 1:if(l.sent().channelClosed)return e.commitPromise=null,r(),[2];l.label=2;case 2:return e.pending.length>0?(e.debounceSend(),e.debounceSend.flush(),e.inflightOpsPromise?[4,e.inflightOpsPromise]:(e.commitPromise=null,r(),e.onError("expected inflight promise",{originalError:null}),[2])):[3,4];case 3:if(l.sent().channelClosed)return e.commitPromise=null,r(),[2];l.label=4;case 4:return e.emit("commitStart"),t=e.version,n=e.serverContent,[4,e.channel.request({flush:{}})];case 5:return(o=l.sent()).channelClosed?(e.flushFailed=0,e.commitPromise=null,r(),[2]):"ok"!==o.body?(e.commitPromise=null,r(),i=o.error||o.toString(),B(i,[s.Df.NotFound,s.Df.AlreadyExists,s.Df.NotDirectory,s.Df.IsDirectory,s.Df.DiskQuotaExceeded])?(e.onError("unable to flush",{originalError:i}),[2]):(e.flushFailed++,setTimeout((function(){e.isReconnecting||e.channel&&"open"===e.channel.status&&e.debounceCommit()}),Math.max(Math.random()*(Math.pow(2,e.flushFailed)-1)*1e3,1e3*Math.pow(2,10))),[2])):(e.shouldTrackDataLoss&&(a=e.uncommittedOps[e.uncommittedOps.length-1])&&P({replId:e.replId,filePath:e.linkedFile,op:{crc32:a.crc32,version:a.version},opType:"latestFlushedOp"}),e.uncommittedOps=[],e.hasUncommittedMultiplayerOps=!1,e.committedVersion=t,e.committedContent=n,e.flushFailed=0,e.emit("commitComplete",t),e.isClean()&&e.emit("fileClean"),e.commitPromise=null,r(),[2,o])}}))}))()},t}(g.EventEmitter),J=$,K=t(84810),Y=t(15519),z=t(92876),G=t(37053),H=t(27135),X=t(98467);function ee(e){var r,t=e.container,p=function(e){Q.push(e),A(),e.then((function(){var r=Q.indexOf(e);r>-1&&Q.splice(r,1),I()}))},v=function(e){var r=!0,t=!1,n=void 0;try{for(var o,i=O[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){(0,o.value)(e)}}catch(a){t=!0,n=a}finally{try{r||null==i.return||i.return()}finally{if(t)throw n}}},m=function(e){if(e.startsWith("/home/runner"))throw new Error("watchTextFile requires relative paths");var r=new J(e,t,Promise.all((0,a.Z)(Q).map((function(e){return e.catch((function(){}))}))).then((function(){})));return r.on("commitComplete",I),r.on("fileDirty",A),r.on("fileClean",A),r.on("commitStart",A),r},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,r=function(r){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];if(n.length>=e)throw new Error("fs: We retried too many things during a closed channel.");return new Promise((function(e){n.push(e)})).then((function(){return r.apply(void 0,(0,a.Z)(o))}))},t=function(){n.splice(0,n.length).forEach((function(e){return e()}))},n=[];return{enqueue:r,flush:t}}(),g=y.enqueue,C=y.flush,E=null,D=null,k=null,F=0,_=new Map,S=new Map,x=new Map,O=[];t.openChannel({service:"fsevents"},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");E=t,t.onCommand((function(e){if("fileEvent"===e.body){if(!e.fileEvent)throw new Error("Expected fileEvent");var r=e.fileEvent,t=r.file,n=r.dest,o=r.op;if(t){var i=t.path;if(null!==i&&null!==o&&void 0!==i&&void 0!==o){var a;if(I(),_.get(i)||t.type===h.api.File.Type.DIRECTORY)a=s.Tv.Directory;else{var l,c=Array.from(_.keys()).find((function(e){return(0,f.pC)(e,i)})),d=c&&(null===(l=_.get(c))||void 0===l?void 0:l.children.find((function(e){return e.filename===(0,u.UO)(i)})));a=d?d.type:s.Tv.File}switch(o){case h.api.FileEvent.Op.Create:j({eventType:s.kS.Create,node:{path:i,type:a}});break;case h.api.FileEvent.Op.Modify:if(a===s.Tv.Directory)break;j({eventType:s.kS.Modify,node:{path:i,type:a}});break;case h.api.FileEvent.Op.Remove:j({eventType:s.kS.Delete,node:{path:i,type:a}});break;case h.api.FileEvent.Op.Move:if(null==n||null==n.path)throw new Error("Expected dest path");var p=n.path;j({eventType:s.kS.Move,node:{path:i,type:a},to:p})}}}}}));var n=(0,a.Z)(new Set((0,a.Z)(_.keys()).concat((0,a.Z)(S.keys()),(0,a.Z)(x.keys()))));return n.length&&t.send({subscribeFile:{files:n.map((function(e){return{path:e}}))}}),function(){E=null}}}));var T=new Promise((function(e){return r=e}));t.openChannel({service:function(e){return e.repl.currentUserPermissions.containerWrite?"gcsfiles":"files"}},(function(e){var t=e.error,n=e.channel;if(!t){if(!n)throw new Error("Expected channel");r(n),C();var o=(0,a.Z)(_.keys()).sort(),i=!0,l=!1,c=void 0;try{for(var u,f=function(){var e=u.value;re.readDir(e).then((function(r){var t=_.get(e);if(t)if(r.error)j({eventType:s.kS.Delete,node:{path:e,type:s.Tv.Directory}});else{var n=r.children,o=t.children,i=o.filter((function(e){return!n.some((function(r){return r.filename===e.filename&&r.type===e.type}))})),a=!0,l=!1,c=void 0;try{for(var u,f=i[Symbol.iterator]();!(a=(u=f.next()).done);a=!0){var h=u.value;j({eventType:s.kS.Delete,node:{path:e===d.Ql?h.filename:e+"/"+h.filename,type:h.type}})}}catch(E){l=!0,c=E}finally{try{a||null==f.return||f.return()}finally{if(l)throw c}}var p=n.filter((function(e){return!o.some((function(r){return r.filename===e.filename&&r.type===e.type}))})),v=!0,m=!1,y=void 0;try{for(var g,w=p[Symbol.iterator]();!(v=(g=w.next()).done);v=!0){var C=g.value;j({eventType:s.kS.Create,node:{path:e===d.Ql?C.filename:e+"/"+C.filename,type:C.type}})}}catch(E){m=!0,y=E}finally{try{v||null==w.return||w.return()}finally{if(m)throw y}}}}))},h=o[Symbol.iterator]();!(i=(u=h.next()).done);i=!0)f()}catch(E){l=!0,c=E}finally{try{i||null==h.return||h.return()}finally{if(l)throw c}}var p=!0,v=!1,m=void 0;try{for(var y,g=function(){var e=y.value;re.readFile(e,{fromDisk:!0}).then((function(r){var t=x.get(e);t&&(r.error?j({eventType:s.kS.Delete,node:{path:e,type:s.Tv.File}}):r.content.toBuffer().equals(t.latestContent.toBuffer())||j({eventType:s.kS.Modify,node:{path:e,type:s.Tv.File}}))}))},w=x.keys()[Symbol.iterator]();!(p=(y=w.next()).done);p=!0)g()}catch(E){v=!0,m=E}finally{try{p||null==w.return||w.return()}finally{if(v)throw m}}return function(){T=new Promise((function(e){return r=e}))}}}));var Z=(0,H.Z)();Z.promise.catch((function(e){return e}));var R=(0,G.Z)((0,n.Z)((function(){var e;return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return[4,Z.promise];case 1:return[4,r.sent().request({fsSnapshot:{}})];case 2:return(e=r.sent()).channelClosed?[2,{success:!1,error:"channel closed"}]:e.error?[2,{success:!1,error:e.error}]:[2,{error:null,success:!0}]}}))})),{wait:5e3,maxWait:1e4});t.openChannel({service:"snapshot",skip:function(e){return!e.repl.currentUserPermissions.containerWrite}},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");return Z.resolve(t),function(){Z.isFulfilled&&(Z=(0,H.Z)()).promise.catch((function(e){return e}))}}Z.isFulfilled||Z.reject(r)}));var L=s.kO.Clean,P=[],M=0;function I(){return N.apply(this,arguments)}function N(){return(N=(0,n.Z)((function(){return(0,l.__generator)(this,(function(e){switch(e.label){case 0:return M++,A(),[4,re.persist()];case 1:return e.sent(),M--,A(),[2]}}))}))).apply(this,arguments)}function A(){return V.apply(this,arguments)}function V(){return(V=(0,n.Z)((function(){var e,r;return(0,l.__generator)(this,(function(t){return e=0===M&&0===Q.length&&Array.from(S.values()).every((function(e){return e.otClient.isClean()})),r=L===s.kO.Clean,e===r||(L=e?s.kO.Clean:s.kO.Syncing,P.forEach((function(e){e(L)}))),[2]}))}))).apply(this,arguments)}var Q=[];function q(e,r){return W.apply(this,arguments)}function W(){return W=(0,n.Z)((function(e,r){var t,o;return(0,l.__generator)(this,(function(i){return t=function(){var r=(0,n.Z)((function(){var r,n,o;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,T];case 1:if("open"!==(r=i.sent()).status)return[2,g(t)];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,r.request(e)];case 3:return n=i.sent(),[3,5];case 4:return o=i.sent(),z.Tb(new Error("Send request failed with error: ".concat(o))),[2,g(t)];case 5:return n.channelClosed?[2,g(t)]:[2,n]}}))}));return function(){return r.apply(this,arguments)}}(),o=t(),r.isMutative&&p(o),[2,o]}))})),W.apply(this,arguments)}function j(e){k=null;var r=e.node.path.includes("/")?(0,u.Il)(e.node.path):d.Ql,t=_.get(r),n=(0,u.UO)(e.node.path);if(!n)throw new Error("Expected filename");var l=null;if(e.eventType===s.kS.Move){var c=e.to.includes("/")?(0,u.Il)(e.to):d.Ql;l=_.get(c)}if(t||l)switch(e.eventType){case s.kS.Create:if(!t)break;var h=(0,a.Z)(t.children.filter((function(e){return e.filename!==n}))).concat([{type:e.node.type,filename:n}]),p=!0,v=!1,m=void 0;try{for(var y,g=t.listeners[Symbol.iterator]();!(p=(y=g.next()).done);p=!0){(0,y.value.onChange)(h)}}catch(De){v=!0,m=De}finally{try{p||null==g.return||g.return()}finally{if(v)throw m}}t.children=h;break;case s.kS.Move:var w=(0,u.UO)(e.to);if(t&&t===l){var C=(0,a.Z)(t.children.filter((function(e){return e.filename!==n&&e.filename!==w}))).concat([{type:e.node.type,filename:w}]),E=!0,D=!1,b=void 0;try{for(var F,O=t.listeners[Symbol.iterator]();!(E=(F=O.next()).done);E=!0){(0,F.value.onChange)(C)}}catch(De){D=!0,b=De}finally{try{E||null==O.return||O.return()}finally{if(D)throw b}}t.children=C;break}if(t){var T=t.children.filter((function(e){return e.filename!==n})),Z=!0,R=!1,L=void 0;try{for(var P,M=t.listeners[Symbol.iterator]();!(Z=(P=M.next()).done);Z=!0){(0,P.value.onChange)(T)}}catch(De){R=!0,L=De}finally{try{Z||null==M.return||M.return()}finally{if(R)throw L}}t.children=T}if(l){var I=(0,a.Z)(l.children.filter((function(e){return e.filename!==n&&e.filename!==w}))).concat([{type:e.node.type,filename:w}]),N=!0,A=!1,B=void 0;try{for(var U,V=l.listeners[Symbol.iterator]();!(N=(U=V.next()).done);N=!0){(0,U.value.onChange)(I)}}catch(De){A=!0,B=De}finally{try{N||null==V.return||V.return()}finally{if(A)throw B}}l.children=I}break;case s.kS.Delete:if(!t)break;var Q=t.children.filter((function(e){return e.filename!==n})),q=!0,W=!1,$=void 0;try{for(var J,K=t.listeners[Symbol.iterator]();!(q=(J=K.next()).done);q=!0){(0,J.value.onChange)(Q)}}catch(De){W=!0,$=De}finally{try{q||null==K.return||K.return()}finally{if(W)throw $}}t.children=Q;break;case s.kS.Modify:break;default:throw new Error("unknown event")}switch(e.eventType){case s.kS.Move:case s.kS.Delete:var Y=[S.get(e.node.path),x.get(e.node.path),_.get(e.node.path)],G=!0,H=!1,X=void 0;try{for(var ee,te=Y[Symbol.iterator]();!(G=(ee=te.next()).done);G=!0){var ne=ee.value;if(ne){var oe=!0,ie=!1,ae=void 0;try{for(var le,se=ne.listeners[Symbol.iterator]();!(oe=(le=se.next()).done);oe=!0){var ce=le.value,ue=ce.onMoveOrDelete,fe=ce.dispose;ue&&ue(e),fe()}}catch(De){ie=!0,ae=De}finally{try{oe||null==se.return||se.return()}finally{if(ie)throw ae}}}}}catch(De){H=!0,X=De}finally{try{G||null==te.return||te.return()}finally{if(H)throw X}}if(e.node.type===s.Tv.File)break;var de=(0,a.Z)(new Set((0,a.Z)(_.keys()).concat((0,a.Z)(x.keys()),(0,a.Z)(S.keys())))).map((function(e){var r=S.get(e)||x.get(e)||_.get(e);if(!r)throw new Error("expected node");return r})),he=[],pe=!0,ve=!1,me=void 0;try{for(var ye,ge=de.sort()[Symbol.iterator]();!(pe=(ye=ge.next()).done);pe=!0){var we=ye.value;if((0,f.yr)(e.node.path,we.path)){var Ce=he.slice(-1)[0];if(!Ce||!(0,f.yr)(Ce,we.path)){var Ee={eventType:s.kS.Delete,node:{path:we.path,type:we.type}};e.eventType===s.kS.Move&&(Ee=(0,i.Z)((0,o.Z)({},Ee),{eventType:s.kS.Move,to:(0,f.hk)(e.node.path,e.to,we.path)})),he.push(we.path),j(Ee)}}}}catch(De){ve=!0,me=De}finally{try{pe||null==ge.return||ge.return()}finally{if(ve)throw me}}break;case s.kS.Create:case s.kS.Modify:if(!x.has(e.node.path))break;re.readFile(e.node.path,{fromDisk:!0}).then((function(r){var t=x.get(e.node.path);if(t)if(r.error)j({eventType:s.kS.Delete,node:{path:e.node.path,type:s.Tv.File}});else{t.latestContent=r.content;var n=!0,o=!1,i=void 0;try{for(var a,l=t.listeners[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var c=a.value.onChange;c&&c(r.content)}}catch(De){o=!0,i=De}finally{try{n||null==l.return||l.return()}finally{if(o)throw i}}}})).catch((function(e){e.message="File read after modify error: "+e.message,z.Tb(e)}))}}function $(){return $=(0,n.Z)((function(){var e,r,n,o,i,s,c,u,f,d;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(!(o=null===(r=t.getContext())||void 0===r||null===(n=r.repl)||void 0===n?void 0:n.language))throw new Error("Expected repl language");return i=window.performance.now(),[4,(e=t).exec.apply(e,["ag","--noaffinity","-g *","--hidden"].concat((0,a.Z)(K.h.map((function(e){return"--ignore=".concat(e)})))))];case 1:return s=l.sent(),c=s.output,u=s.error,(0,b.j)(b.U3.LIST_FILES_EXECUTED,{duration:window.performance.now()-i,failed:Boolean(u)&&"exit status 1"!==u}),f=function(e){return!!e&&(!(0,K.C)(e)&&!Y.Z.isLangFileBinary(o,e))},!u&&c?[2,k={error:null,files:c.split("\n").filter(f)}]:u&&u.includes("not found")?[4,t.exec("find",".","-type","f","-print0")]:[3,3];case 2:if((d=l.sent()).output)return[2,k={error:null,files:d.output.slice(2,-1).split("\0./").filter(f)}];l.label=3;case 3:return"exit status 1"!==u&&z.Tb(new Error("Find file command failed with error: ".concat(u))),[2,{error:u,files:null}]}}))})),$.apply(this,arguments)}var ee=function(){var e=(0,n.Z)((function(e,r,t){var o,i,a,c,u,f,d,h;function p(e){return m.apply(this,arguments)}function m(){return(m=(0,n.Z)((function(e){var r;return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return[4,o.request(e)];case 1:if((r=t.sent()).channelClosed)throw new Error("channelClosed");if(r.error)throw new Error(r.error);return[2,r]}}))}))).apply(this,arguments)}return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,T];case 1:o=n.sent(),i={eventType:s.kS.Create,node:{path:e,type:s.Tv.File}},n.label=2;case 2:return n.trys.push([2,9,,10]),[4,p({transferStart:{path:e,size:r.length}})];case 3:if(!(a=n.sent().transfer))throw new Error("Failed to start a transfer (no transfer id)");c=r.toBuffer(),u=512e3,t(c.length,0),f=0,n.label=4;case 4:return f<Math.ceil(r.length/u)?[4,p({transferChunk:{id:a.id,content:c.subarray(f*u,(f+1)*u)}})]:[3,7];case 5:n.sent(),t(c.length,Math.min(c.length,(f+1)*u)),n.label=6;case 6:return f++,[3,4];case 7:return[4,p({transferComplete:{id:a.id,crc32:w.buf(c)}})];case 8:return n.sent(),[3,10];case 9:if("channelClosed"===(d=n.sent()).message)return[2,g(re.transferFile,e,r,t)];if((h=B(d.message,[s.Df.NotDirectory,s.Df.AlreadyExists,s.Df.DiskQuotaExceeded]))===s.Df.DiskQuotaExceeded&&v(i),h===s.Df.AlreadyExists&&(h=s.Df.IsDirectory),h)return[2,{error:h}];throw d;case 10:return j(i),[2,{error:null}]}}))}));return function(r,t,n){return e.apply(this,arguments)}}(),re={getStatus:function(){return L},onStatusChange:function(e){return P.push(e),function(){var r=P.indexOf(e);r>-1&&P.splice(r,1)}},watchDir:function(e,r){var t=!1,n=function(){t=!0;var r=_.get(e);r&&(r.listeners=r.listeners.filter((function(e){return e.dispose!==n})),0===r.listeners.length&&_.delete(e))};return re.readDir(e).then((function(a){if(!t){if(a.error){var l=new Error(a.error);return l.code=a.error,r.onError(l),void n()}var c=_.get(e);c||(c={path:e,type:s.Tv.Directory,children:a.children,listeners:[]},_.set(e,c),E&&E.send({subscribeFile:{files:[{path:e}]}})),c.listeners.push((0,i.Z)((0,o.Z)({},r),{dispose:n})),r.onChange(a.children)}})).catch((function(e){n(),r.onError(e)})),n},writeFile:function(e,r){return(0,n.Z)((function(){var t,n,o,i,a,f;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return n="string"===typeof r?c.Z.from(r).toBuffer():r.toBuffer(),[4,q({write:{path:e,content:n}},{isMutative:!0})];case 1:if(o=l.sent(),a=null===(t=_.get((0,u.Il)(e)))||void 0===t?void 0:t.children.some((function(r){return r.filename===(0,u.UO)(e)})),i=x.has(e)||S.has(e)||a?{eventType:s.kS.Modify,node:{path:e,type:s.Tv.File}}:{eventType:s.kS.Create,node:{path:e,type:s.Tv.File}},o.error){if((f=B(o.error,[s.Df.NotDirectory,s.Df.AlreadyExists,s.Df.DiskQuotaExceeded]))===s.Df.DiskQuotaExceeded&&v(i),f===s.Df.AlreadyExists&&(f=s.Df.IsDirectory),!f)throw new Error(o.error);return[2,{error:f}]}return j(i),[2,{error:null}]}}))}))()},transferFile:function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.Z)((function(){var e;return(0,l.__generator)(this,(function(t){return e=ee.apply(void 0,(0,a.Z)(r)),p(e),[2,e]}))}))()},readFile:function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromDisk:!1}).fromDisk;return(0,n.Z)((function(){var t,n,o,i;return(0,l.__generator)(this,(function(a){switch(a.label){case 0:if(!r){if((t=S.get(e))&&t.otClient.getRawLocalContent()&&!t.otClient.isReconnecting)return[2,{content:c.Z.from(t.otClient.getRawLocalContent()),error:null}];if(n=x.get(e))return[2,{content:n.latestContent,error:null}]}return[4,q({read:{path:e}},{isMutative:!1})];case 1:if((o=a.sent()).error){if(!(i=B(o.error,[s.Df.NotFound,s.Df.IsDirectory])))throw new Error(o.error);return[2,{error:i}]}if(!o.file||!o.file.path||!o.file.content)throw new Error("Expected file");return[2,{content:c.Z.from(o.file.content),error:null}]}}))}))()},createDir:function(e){return(0,n.Z)((function(){var r,t,n;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:return[4,q({mkdir:{path:e}},{isMutative:!0})];case 1:if(r=o.sent(),t={eventType:s.kS.Create,node:{path:e,type:s.Tv.Directory}},r.error){if((n=B(r.error,[s.Df.NotDirectory,s.Df.DiskQuotaExceeded]))===s.Df.DiskQuotaExceeded&&v(t),!n)throw new Error(r.error);return[2,{error:n}]}return j(t),[2,{error:null}]}}))}))()},moveDir:function(e,r){return(0,n.Z)((function(){var t,n,o;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,q({move:{oldPath:e,newPath:r}},{isMutative:!0})];case 1:if(t=i.sent(),n={eventType:s.kS.Move,node:{path:e,type:s.Tv.Directory},to:r},t.error){if((o=B(t.error,[s.Df.NotFound,s.Df.AlreadyExists,s.Df.NotDirectory,s.Df.DiskQuotaExceeded]))===s.Df.DiskQuotaExceeded&&v(n),!o)throw new Error(t.error);return[2,{error:o}]}return j(n),[2,{error:null}]}}))}))()},moveFile:function(e,r){return(0,n.Z)((function(){var t,n,o;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,q({move:{oldPath:e,newPath:r}},{isMutative:!0})];case 1:if(t=i.sent(),n={eventType:s.kS.Move,node:{path:e,type:s.Tv.File},to:r},t.error){if((o=B(t.error,[s.Df.NotFound,s.Df.AlreadyExists,s.Df.NotDirectory,s.Df.DiskQuotaExceeded]))===s.Df.DiskQuotaExceeded&&v(n),!o)throw new Error(t.error);return[2,{error:o}]}return j(n),[2,{error:null}]}}))}))()},copyFile:function(e,r){return(0,n.Z)((function(){var t;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,re.readFile(e)];case 1:return(t=n.sent()).error?[2,t]:[2,re.writeFile(r,t.content)]}}))}))()},copyDirFromRemote:function(e,r,t){return(0,n.Z)((function(){var n,o,i,a,c,u,f,d,h,p,v,m,y;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return[4,this.deleteDir(e)];case 1:return l.sent(),[4,t.readDir(e)];case 2:return(n=l.sent()).error?[2,n]:[4,this.readDir(r)];case 3:return(o=l.sent()).error!==s.Df.NotFound?[3,5]:[4,this.createDir(e)];case 4:return l.sent(),[3,6];case 5:if(o.error===s.Df.NotDirectory)return[2,o];l.label=6;case 6:i=!0,a=!1,c=void 0,l.label=7;case 7:l.trys.push([7,15,16,17]),u=n.children[Symbol.iterator](),l.label=8;case 8:return(i=(f=u.next()).done)?[3,14]:(d=f.value,h="".concat(e,"/").concat(d.filename),d.type!==s.Tv.File?[3,11]:[4,t.readFile(h)]);case 9:return(p=l.sent()).error?[2,p]:[4,this.writeFile("".concat(r,"/").concat(d.filename),p.content)];case 10:return(v=l.sent()).error?[2,v]:[3,13];case 11:return d.type!==s.Tv.Directory?[3,13]:[4,this.copyDirFromRemote(h,"".concat(r,"/").concat(d.filename),t)];case 12:if((m=l.sent()).error)return[2,m];l.label=13;case 13:return i=!0,[3,8];case 14:return[3,17];case 15:return y=l.sent(),a=!0,c=y,[3,17];case 16:try{i||null==u.return||u.return()}finally{if(a)throw c}return[7];case 17:return[2,{error:null}]}}))})).apply(this)},copyFileFromRemote:function(e,r,t){return(0,n.Z)((function(){var n,o;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.readFile(e)];case 1:return(n=i.sent()).error?[2,n]:[4,this.writeFile(r,n.content)];case 2:return(o=i.sent()).error?[2,o]:[2,{error:null}]}}))})).apply(this)},deleteFile:function(e){return(0,n.Z)((function(){var r,t;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,q({remove:{path:e}},{isMutative:!0})];case 1:if((r=n.sent()).error){if(!(t=B(r.error,[s.Df.NotFound])))throw new Error(r.error);return[2,{error:t}]}return j({eventType:s.kS.Delete,node:{path:e,type:s.Tv.File}}),[2,{error:null}]}}))}))()},deleteDir:function(e){return(0,n.Z)((function(){var r,t;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,q({remove:{path:e}},{isMutative:!0})];case 1:if((r=n.sent()).error){if(!(t=B(r.error,[s.Df.NotFound])))throw new Error(r.error);return[2,{error:t}]}return j({eventType:s.kS.Delete,node:{path:e,type:s.Tv.Directory}}),[2,{error:null}]}}))}))()},readDir:function(e){return(0,n.Z)((function(){var r,t,n;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:return[4,q({readdir:{path:e}},{isMutative:!1})];case 1:if((t=o.sent()).error){if(!(n=B(t.error,[s.Df.NotFound,s.Df.NotDirectory])))throw new Error(t.error);return[2,{error:n}]}if(!(null===(r=t.files)||void 0===r?void 0:r.files))throw new Error("Expected filesChannel");return[2,{children:t.files.files.map((function(e){if(!e.path)throw new Error("Expected path");return{filename:e.path,type:e.type===h.api.File.Type.DIRECTORY?s.Tv.Directory:s.Tv.File}})),error:null}]}}))}))()},stat:function(e){return(0,n.Z)((function(){var r;return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return[4,q({stat:{path:e}},{isMutative:!1})];case 1:if((r=t.sent()).error)throw new Error(r.error);if(!r.statRes)throw new Error("expected stat result");return r.statRes.exists?r.statRes.type===h.api.File.Type.DIRECTORY?[2,{exists:!0,type:s.Tv.Directory,lastModified:new Date(1e3*r.statRes.modTime)}]:[2,{exists:!0,type:s.Tv.File,lastModified:new Date(1e3*r.statRes.modTime),byteLength:Number(r.statRes.size)}]:[2,{exists:!1}]}}))}))()},watchTextFile:function(e,r){var t=this,c=S.get(e);if(c||(c={path:e,type:s.Tv.File,listeners:[],otClient:m(e)},S.set(e,c)),!c)throw new Error("Expected watchedOtFile");var u=!1,f=!1,d=function(){},h=[],p=function(o){if(d(),!c)throw new Error("Expected watchedOtFile");var i=function(e){var t;return null===(t=r.onFlush)||void 0===t?void 0:t.call(r,e)};c.otClient.on("commitComplete",i);var g=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,s.KF.Dirty)};c.otClient.on("fileDirty",g);var w=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,s.KF.Clean)};c.otClient.on("fileClean",w);var C=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,s.KF.Syncing)};c.otClient.on("commitStart",C);var E=function(e){var t;return null===(t=r.onCursor)||void 0===t?void 0:t.call(r,e)};c.otClient.on("cursor",E);var D=function(e){var t;return null===(t=r.onRemoveCursor)||void 0===t?void 0:t.call(r,e)};c.otClient.on("removeCursor",D);var k=t,b=function(){var r=(0,n.Z)((function(r){var t,n,o,i,a,s,u,f,d,p,v;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(!c)throw new Error("Expected watchedOtFile");return(t=c.otClient).destroy(),n=m(e),[4,new Promise((function(e,r){n.once("changes",(function(){return e()})),n.once("error",(function(e){return r(e)}))}))];case 1:if(l.sent(),o=t.getLocalContent(),i=n.getLocalContent(),a="local"===r?(0,X.F)(i,o):null,s="remote"===r?(0,X.F)(o,i):null,!c)throw new Error("Expected watchedOtFile");c.otClient=n,u=!0,f=!1,d=void 0;try{for(p=c.listeners[Symbol.iterator]();!(u=(v=p.next()).done);u=!0)(0,v.value.reregister)(s)}catch(g){f=!0,d=g}finally{try{u||null==p.return||p.return()}finally{if(f)throw d}}for(a&&n.writeChanges(a);h.length>0;){var y;null===(y=h.pop())||void 0===y||y({isDisposed:!1})}return[4,k.flush()];case 2:return l.sent(),[2]}}))}));return function(e){return r.apply(this,arguments)}}(),F=function(e){var t;return null===(t=r.onReconnectFail)||void 0===t?void 0:t.call(r,b,e)};c.otClient.on("promptUserReconnect",F),c.listeners[0].reregister===p&&c.otClient.on("promptUserReconnect",(function(){if(S.has(e)){if(!c)throw new Error("Expected watchedOtFile");c.listeners.some((function(e){return e.onReconnectFail}))||b("remote")}}));var _=function(e,t){r.onError&&r.onError(e,t),y()};c.otClient.on("error",_);var x=function(t,n){if(t===s.Df.DiskQuotaExceeded&&v({eventType:s.kS.Modify,node:{path:e,type:s.Tv.File}}),r.onError){var o=new Error(n);o.code=t,r.onError(o)}y()};c.otClient.on("fsError",x);var O=function(e,t){if(!c)throw new Error("Expected watchedOtFile");var n=U.as.of(e,c.otClient.getLocalContent().length,"\n");c.otClient.writeChanges(n,t);var o=!0,i=!1,a=void 0;try{for(var l,u=c.listeners[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var f=l.value.onChange;f&&f!==r.onChange&&f({changes:n,changeSource:s.Fl.Local,version:c.otClient.version,latestContent:c.otClient.getLocalContent()})}}catch(d){i=!0,a=d}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}},T=function(){var e=(0,n.Z)((function(){return(0,l.__generator)(this,(function(e){return(null===c||void 0===c?void 0:c.otClient.isReconnecting)?[2,new Promise((function(e,r){c?h.push(e):r(new Error("Expected watchedOtFile"))}))]:[2,{isDisposed:u}]}))}));return function(){return e.apply(this,arguments)}}(),Z=function(){for(;h.length>0;){var e;null===(e=h.pop())||void 0===e||e({isDisposed:!1})}};c.otClient.on("transparentReconnect",Z);var R,L=function(){var e=(0,n.Z)((function(){var e,r,t,n,o,i=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:for(e=i.length,r=new Array(e),t=0;t<e;t++)r[t]=i[t];if(!c)throw new Error("Expected watchedOtFile");l.label=1;case 1:return l.trys.push([1,3,,4]),[4,T()];case 2:return l.sent().isDisposed?[2,{isDisposed:!0,result:null}]:[3,4];case 3:if(o=l.sent(),u)return[2,{isDisposed:!0,result:null}];throw o;case 4:return[4,(n=c.otClient).fetchChanges.apply(n,(0,a.Z)(r))];case 5:return[2,{isDisposed:!1,result:l.sent()}]}}))}));return function(){return e.apply(this,arguments)}}(),P=function(){var e=(0,n.Z)((function(){var e,r,t,n,o=arguments;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:for(e=o.length,r=new Array(e),t=0;t<e;t++)r[t]=o[t];if(!c)throw new Error("Expected watchedOtFile");return[4,T()];case 1:if(i.sent().isDisposed)throw new Error("File was disposed");return[2,(n=c.otClient).transformSelection.apply(n,(0,a.Z)(r))]}}))}));return function(){return e.apply(this,arguments)}}(),M=function(e){if(!c)throw new Error("Expected watchedOtFile");c.otClient.updateCursors(e)};(-1!==c.otClient.version&&setTimeout((function(){var e;if(!f){if(!c)throw new Error("Expected watchedOtFile");f=!0,null===(e=r.onReady)||void 0===e||e.call(r,{initialContent:c.otClient.getLocalContent(),writeChange:O,updateSelections:M,fetchChanges:L,transformSelection:P,version:c.otClient.version})}})),o)&&(null===(R=r.onChange)||void 0===R||R.call(r,{changes:o,changeSource:s.Fl.Container,version:c.otClient.version,latestContent:c.otClient.getLocalContent()}));var I=function(e){var t,n;if(!c)throw new Error("Expected watchedOtFile");if(!f)return f=!0,void(null===(n=r.onReady)||void 0===n||n.call(r,{initialContent:c.otClient.getLocalContent(),writeChange:O,updateSelections:M,fetchChanges:L,transformSelection:P,version:c.otClient.version}));null===(t=r.onChange)||void 0===t||t.call(r,{changes:e,changeSource:s.Fl.Container,version:c.otClient.version,latestContent:c.otClient.getLocalContent()})};c.otClient.on("changes",I),d=function(){if(!c)throw new Error("Expected watchedOtFile");c.otClient.removeListener("commitComplete",i),c.otClient.removeListener("fileDirty",g),c.otClient.removeListener("fileClean",w),c.otClient.removeListener("commitStart",C),c.otClient.removeListener("error",_),c.otClient.removeListener("fsError",x),c.otClient.removeListener("changes",I),c.otClient.removeListener("cursor",E),c.otClient.removeListener("removeCursor",D),c.otClient.removeListener("promptUserReconnect",F),c.otClient.removeListener("transparentReconnect",Z)},A()},y=function(){for(;h.length>0;){var r;null===(r=h.pop())||void 0===r||r({isDisposed:!0})}if(!u&&S.has(e)){if(u=!0,f=!0,d(),!c)throw new Error("Expected watchedOtFile");c.listeners=c.listeners.filter((function(e){return e.dispose!==y})),0===c.listeners.length&&(c.otClient.destroy(),S.delete(e))}};return c.listeners.push((0,i.Z)((0,o.Z)({},r),{dispose:y,reregister:p})),p(null),y},watchFile:function(e,r){var t=!1,n=function(){t=!0;var r=x.get(e);r&&(r.listeners=r.listeners.filter((function(e){return e.dispose!==n})),0===r.listeners.length&&x.delete(e))};return re.readFile(e).then((function(a){if(!t){if(a.error){var l=new Error(a.error);return l.code=a.error,r.onError&&r.onError(l),void n()}var c=x.get(e);if(c||(c={path:e,type:s.Tv.File,listeners:[],latestContent:a.content},x.set(e,c),E&&E.send({subscribeFile:{files:[{path:e}]}})),!c)throw new Error("Expected watched file");c.listeners.push((0,i.Z)((0,o.Z)({},r),{dispose:n})),r.onChange(a.content)}})),n},listFiles:function(){return(0,n.Z)((function(){var e;return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return k&&window.performance.now()-F<1e4?[2,k]:(D||(D=function(){return $.apply(this,arguments)}(),F=window.performance.now()),[4,D]);case 1:return e=r.sent(),D=null,[2,e]}}))}))()},flush:function(){var e=[],r=!0,t=!1,n=void 0;try{for(var o,i=S.values()[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var l=o.value;null!==l.otClient.channel&&(l.otClient.isReconnecting||e.push(l.otClient.flush()))}}catch(s){t=!0,n=s}finally{try{r||null==i.return||i.return()}finally{if(t)throw n}}return Promise.all((0,a.Z)(e).concat((0,a.Z)(Q)).map((function(e){return e.catch((function(){}))}))).then((function(){}))},persist:function(e){var r=R();return e&&e.skipDebounce&&R.flush(),r},getOTVersion:function(e){var r=S.get(e);if(!r)throw new Error("No file with path ".concat(e," found."));return r.otClient.version},onDiskQuotaExceeded:function(e){return O.push(e),function(){O=O.filter((function(r){return r!==e}))}}};return re}},58794:function(e,r,t){t.d(r,{Z:function(){return l}});var n=t(51438),o=t(52951),i=t(82670),a=t(48764).lW,l=function(){function e(r,t){if((0,n.Z)(this,e),this.asEncoding={},this.asBuffer=null,t&&"string"===typeof r)this.asEncoding[t]=r;else if(void 0===r||null===r)this.asBuffer=a.alloc(0);else if((0,i.Z)(r,a))this.asBuffer=r;else if("string"===typeof r)this.asEncoding.utf8=r;else if((0,i.Z)(r,ArrayBuffer))this.asBuffer=a.from(r);else{if((0,i.Z)(r,e))return r;(0,i.Z)(r,Uint8Array)?this.asBuffer=a.from(r):"object"!==typeof r||"object"!==typeof r.asEncoding||null===r.asEncoding||!(0,i.Z)(r.asBuffer,a)&&null!==r.asBuffer||(this.asBuffer=r.asBuffer||null,"string"===typeof r.asEncoding.base64&&(this.asEncoding={base64:r.asEncoding.base64}),"string"===typeof r.asEncoding.utf8&&(this.asEncoding={utf8:r.asEncoding.utf8}))}}var r=e.prototype;return r.toString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";if(void 0!==this.asEncoding[e])return this.asEncoding[e];var r=this.toBuffer(),t=r.toString(e);return this.asEncoding[e]=t,t},r.toJSON=function(){return{asEncoding:{base64:this.toString("base64")},asBuffer:null}},r.toBuffer=function(){if(this.asBuffer)return this.asBuffer;for(var e in this.asEncoding){var r=this.asEncoding[e];if("string"===typeof r){var t=a.from(r,e);return this.asBuffer=t,t}}return this.asBuffer=a.alloc(0),this.asBuffer},e.from=function(r,t){return new e(r,t)},e.isBuffer=function(r){return(0,i.Z)(r,e)},(0,o.Z)(e,[{key:"length",get:function(){return void 0!==this.asEncoding.utf8?this.asEncoding.utf8.length:this.toBuffer().length}}]),e}()},84810:function(e,r,t){t.d(r,{C:function(){return o},h:function(){return i}});var n=/^(\.env$|\.npm$|\.npm\/|__pycache__|\.cache|\.breakpoints|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner)/;function o(e){return n.test(e)}var i=[".git",".upm",".cache","__pycache__","node_modules","venv"]}}]);
//# sourceMappingURL=7194-3a80789b275e3ba2.js.map